<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スクショウ スコア計算機</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .card-selection {
            margin-bottom: 20px;
        }
        .card-slot {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .card-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .card-row label {
            margin: 0;
            min-width: 80px;
        }
        select {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .skill-params {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        .skill-param-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        .skill-param-row label {
            min-width: 120px;
            font-size: 14px;
        }
        .skill-param-row input {
            flex: 1;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
        }
        .skill-level-select {
            width: 120px;
        }
        button {
            width: 100%;
            padding: 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        #result {
            margin-top: 30px;
            padding: 20px;
            background-color: #f0f8ff;
            border-radius: 5px;
            text-align: center;
            display: none;
        }
        #score {
            font-size: 36px;
            font-weight: bold;
            color: #2196F3;
            margin: 10px 0;
        }
        #turnLog {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            display: none;
        }
        .toggle-log {
            margin-top: 10px;
            padding: 10px;
            background-color: #2196F3;
            font-size: 14px;
        }
        .toggle-log:hover {
            background-color: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>スクショウ スコア計算機</h1>
        
        <div class="form-group">
            <label for="appeal">アピール値:</label>
            <input type="number" id="appeal" value="88146" min="0">
        </div>
        
        <div class="form-group">
            <label>楽曲選択:</label>
            <select id="music" onchange="toggleMusicInput()">
                <option value="i_do_me">I Do Me (11, 7, 5)</option>
                <option value="custom">カスタム入力</option>
            </select>
        </div>
        
        <div id="customMusic" style="display: none;">
            <div class="form-group">
                <label>フィーバー前ターン数:</label>
                <input type="number" id="beforeFever" value="11" min="0">
            </div>
            <div class="form-group">
                <label>フィーバー中ターン数:</label>
                <input type="number" id="duringFever" value="7" min="0">
            </div>
            <div class="form-group">
                <label>フィーバー後ターン数:</label>
                <input type="number" id="afterFever" value="5" min="0">
            </div>
        </div>
        
        <div class="card-selection">
            <h3>カード選択（順番通りに）:</h3>
            <div class="card-slot">
                <div class="card-row">
                    <label>カード1:</label>
                    <select id="card1" onchange="onCardChange(1)">
                        <option value="">未選択</option>
                    </select>
                    <select id="skill1" class="skill-level-select" onchange="onSkillLevelChange(1)" style="display: none;">
                        <option value="14">スキルLv14</option>
                        <option value="13">スキルLv13</option>
                        <option value="12">スキルLv12</option>
                        <option value="11">スキルLv11</option>
                        <option value="10">スキルLv10</option>
                        <option value="9">スキルLv9</option>
                        <option value="8">スキルLv8</option>
                        <option value="7">スキルLv7</option>
                        <option value="6">スキルLv6</option>
                        <option value="5">スキルLv5</option>
                        <option value="4">スキルLv4</option>
                        <option value="3">スキルLv3</option>
                        <option value="2">スキルLv2</option>
                        <option value="1">スキルLv1</option>
                    </select>
                </div>
                <div id="skillParams1" class="skill-params"></div>
            </div>
            <div class="card-slot">
                <div class="card-row">
                    <label>カード2:</label>
                    <select id="card2" onchange="onCardChange(2)">
                        <option value="">未選択</option>
                    </select>
                    <select id="skill2" class="skill-level-select" onchange="onSkillLevelChange(2)" style="display: none;">
                        <option value="14">スキルLv14</option>
                        <option value="13">スキルLv13</option>
                        <option value="12">スキルLv12</option>
                        <option value="11">スキルLv11</option>
                        <option value="10">スキルLv10</option>
                        <option value="9">スキルLv9</option>
                        <option value="8">スキルLv8</option>
                        <option value="7">スキルLv7</option>
                        <option value="6">スキルLv6</option>
                        <option value="5">スキルLv5</option>
                        <option value="4">スキルLv4</option>
                        <option value="3">スキルLv3</option>
                        <option value="2">スキルLv2</option>
                        <option value="1">スキルLv1</option>
                    </select>
                </div>
                <div id="skillParams2" class="skill-params"></div>
            </div>
            <div class="card-slot">
                <div class="card-row">
                    <label>カード3:</label>
                    <select id="card3" onchange="onCardChange(3)">
                        <option value="">未選択</option>
                    </select>
                    <select id="skill3" class="skill-level-select" onchange="onSkillLevelChange(3)" style="display: none;">
                        <option value="14">スキルLv14</option>
                        <option value="13">スキルLv13</option>
                        <option value="12">スキルLv12</option>
                        <option value="11">スキルLv11</option>
                        <option value="10">スキルLv10</option>
                        <option value="9">スキルLv9</option>
                        <option value="8">スキルLv8</option>
                        <option value="7">スキルLv7</option>
                        <option value="6">スキルLv6</option>
                        <option value="5">スキルLv5</option>
                        <option value="4">スキルLv4</option>
                        <option value="3">スキルLv3</option>
                        <option value="2">スキルLv2</option>
                        <option value="1">スキルLv1</option>
                    </select>
                </div>
                <div id="skillParams3" class="skill-params"></div>
            </div>
            <div class="card-slot">
                <div class="card-row">
                    <label>カード4:</label>
                    <select id="card4" onchange="onCardChange(4)">
                        <option value="">未選択</option>
                    </select>
                    <select id="skill4" class="skill-level-select" onchange="onSkillLevelChange(4)" style="display: none;">
                        <option value="14">スキルLv14</option>
                        <option value="13">スキルLv13</option>
                        <option value="12">スキルLv12</option>
                        <option value="11">スキルLv11</option>
                        <option value="10">スキルLv10</option>
                        <option value="9">スキルLv9</option>
                        <option value="8">スキルLv8</option>
                        <option value="7">スキルLv7</option>
                        <option value="6">スキルLv6</option>
                        <option value="5">スキルLv5</option>
                        <option value="4">スキルLv4</option>
                        <option value="3">スキルLv3</option>
                        <option value="2">スキルLv2</option>
                        <option value="1">スキルLv1</option>
                    </select>
                </div>
                <div id="skillParams4" class="skill-params"></div>
            </div>
            <div class="card-slot">
                <div class="card-row">
                    <label>カード5:</label>
                    <select id="card5" onchange="onCardChange(5)">
                        <option value="">未選択</option>
                    </select>
                    <select id="skill5" class="skill-level-select" onchange="onSkillLevelChange(5)" style="display: none;">
                        <option value="14">スキルLv14</option>
                        <option value="13">スキルLv13</option>
                        <option value="12">スキルLv12</option>
                        <option value="11">スキルLv11</option>
                        <option value="10">スキルLv10</option>
                        <option value="9">スキルLv9</option>
                        <option value="8">スキルLv8</option>
                        <option value="7">スキルLv7</option>
                        <option value="6">スキルLv6</option>
                        <option value="5">スキルLv5</option>
                        <option value="4">スキルLv4</option>
                        <option value="3">スキルLv3</option>
                        <option value="2">スキルLv2</option>
                        <option value="1">スキルLv1</option>
                    </select>
                </div>
                <div id="skillParams5" class="skill-params"></div>
            </div>
            <div class="card-slot">
                <div class="card-row">
                    <label>カード6:</label>
                    <select id="card6" onchange="onCardChange(6)">
                        <option value="">未選択</option>
                    </select>
                    <select id="skill6" class="skill-level-select" onchange="onSkillLevelChange(6)" style="display: none;">
                        <option value="14">スキルLv14</option>
                        <option value="13">スキルLv13</option>
                        <option value="12">スキルLv12</option>
                        <option value="11">スキルLv11</option>
                        <option value="10">スキルLv10</option>
                        <option value="9">スキルLv9</option>
                        <option value="8">スキルLv8</option>
                        <option value="7">スキルLv7</option>
                        <option value="6">スキルLv6</option>
                        <option value="5">スキルLv5</option>
                        <option value="4">スキルLv4</option>
                        <option value="3">スキルLv3</option>
                        <option value="2">スキルLv2</option>
                        <option value="1">スキルLv1</option>
                    </select>
                </div>
                <div id="skillParams6" class="skill-params"></div>
            </div>
        </div>
        
        <button onclick="calculate()">スコア計算</button>
        
        <div id="result">
            <h2>計算結果</h2>
            <div id="score"></div>
            <button class="toggle-log" onclick="toggleLog()">詳細ログを表示</button>
        </div>
        
        <div id="turnLog"></div>
    </div>

    <script>
        // Global data loaded from JSON
        let cardData = {};
        let musicData = {};

        // Game class
        class Game {
            constructor(cards, appeal, music, verbose = false) {
                this.score = 0;
                this.scoreBoost = new Array(100).fill(0);
                this.scoreBoostCount = 0;
                this.voltagePt = 0;
                this.voltageBoost = new Array(100).fill(0);
                this.voltageBoostCount = 0;
                this.turn = 0;
                this.cards = cards;
                this.cardTurn = 0;
                this.mental = 100;
                this.appeal = appeal;
                this.music = music;
                this.verbose = verbose;
                this.log = "";
            }

            doGame() {
                while (this.turn < this.music.reduce((a, b) => a + b, 0)) {
                    this.turnUp();
                }
            }

            turnUp() {
                if (this.cardTurn >= this.cards.length) {
                    this.cardTurn = 0;
                }
                if (this.verbose) {
                    this.log += `turn ${this.turn + 1}\n`;
                }
                const card = this.cards[this.cardTurn];
                card.do(this);
            }

            getVoltageLevel() {
                const getSubVoltageLevel = () => {
                    const voltageLevels = [0, 10, 30, 60, 100, 150, 210, 280, 360, 450, 550, 660, 780, 910, 1050, 1200, 1360, 1530, 1710, 1900];
                    if (this.voltagePt < 1900) {
                        for (let i = 0; i < voltageLevels.length; i++) {
                            if (this.voltagePt < voltageLevels[i]) {
                                return i;
                            }
                        }
                    }
                    return 19 + Math.floor((this.voltagePt - 1900) / 200);
                };
                
                let voltage = getSubVoltageLevel();
                if (this.music[0] + 1 <= this.turn && this.turn <= this.music[0] + this.music[1]) {
                    voltage *= 2;
                }
                return voltage;
            }

            doScoreBoost(value, times = 1) {
                for (let i = 0;i < times; i++) {
                    this.scoreBoost[this.scoreBoostCount + i] += value;
                }
                if (this.verbose) {
                    this.log += `score boost ${value}, reach ${this.scoreBoost[this.scoreBoostCount]}\n`;
                }
            }

            doVoltageBoost(value, times = 1) {
                for (let i = 0; i < times; i++) {
                    this.voltageBoost[this.voltageBoostCount + i] += value;
                }
                if (this.verbose) {
                    this.log += `voltage boost ${value}, reach ${this.voltageBoost[this.voltageBoostCount]}\n`;
                }
            }

            getScore(value) {
                const score = Math.floor(this.appeal * value * (1 + this.scoreBoost[this.scoreBoostCount]) * (1 + this.getVoltageLevel() / 10)) * 1.5;
                this.score += score;
                this.scoreBoostCount += 1;
                if (this.verbose) {
                    this.log += `get score ${score} = ${value} * ${this.appeal} * (1 + ${this.scoreBoost[this.scoreBoostCount - 1]}) * ${1 + this.getVoltageLevel() / 10} * 1.5\n`;
                }
            }

            getVoltage(value) {
                const voltagePt = Math.floor(value * (1 + this.voltageBoost[this.voltageBoostCount]));
                this.voltagePt += voltagePt;
                if (this.verbose) {
                    this.log += `get voltage ${voltagePt} = ${value} * (1 + ${this.voltageBoost[this.voltageBoostCount]})\n`;
                }
                this.voltageBoostCount += 1;
            }
        }

        // Base Card class
        class Card {
            constructor() {
                this.count = 0;
                this.name = "";
            }

            do(game) {
                if (game.verbose) {
                    game.log += `done ${this.name}\n`;
                }
                this.count += 1;
                game.turn += 1;
                game.cardTurn += 1;
            }
        }

        // Generic card implementation using JSON data
        class GenericCard extends Card {
            constructor(cardKey, cardConfig, skillValues) {
                super();
                this.cardKey = cardKey;
                this.name = cardConfig.name.toLowerCase();
                this.config = cardConfig;
                this.skillValues = skillValues || {};
            }

            do(game) {
                const effects = this.config.effects;
                
                // Process effects array sequentially
                for (let i = 0; i < effects.length; i++) {
                    const effect = effects[i];
                    
                    switch (effect.type) {
                        case 'skipTurn':
                            if (this.evaluateCondition(effect.condition, game)) {
                                game.cardTurn += 1;
                                return;
                            }
                            break;
                            
                        case 'scoreBoost':
                            const scoreBoostValue = this.skillValues[`effect_${i}_value`] !== undefined ? 
                                parseFloat(this.skillValues[`effect_${i}_value`]) : effect.value;
                            game.doScoreBoost(scoreBoostValue);
                            break;
                            
                        case 'voltageBoost':
                            const voltageBoostValue = this.skillValues[`effect_${i}_value`] !== undefined ? 
                                parseFloat(this.skillValues[`effect_${i}_value`]) : effect.value;
                            game.doVoltageBoost(voltageBoostValue);
                            break;
                            
                        case 'scoreGain':
                            const scoreGainValue = this.skillValues[`effect_${i}_value`] !== undefined ? 
                                parseFloat(this.skillValues[`effect_${i}_value`]) : effect.value;
                            game.getScore(scoreGainValue);
                            break;
                            
                        case 'voltageGain':
                            const voltageGainValue = this.skillValues[`effect_${i}_value`] !== undefined ? 
                                parseInt(this.skillValues[`effect_${i}_value`]) : effect.value;
                            game.getVoltage(voltageGainValue);
                            break;
                            
                        case 'voltagePenalty':
                            game.voltagePt -= effect.value;
                            break;
                            
                        case 'mentalRecover':
                            game.mental += effect.value;
                            break;
                            
                        case 'resetCardTurn':
                            game.cardTurn = -1;
                            break;
                            
                        case 'conditional':
                            if (this.evaluateCondition(effect.condition, game)) {
                                // Process "then" effects
                                this.processEffects(effect.then, game, `effect_${i}_then`);
                            } else if (effect.else) {
                                // Process "else" effects
                                this.processEffects(effect.else, game, `effect_${i}_else`);
                            }
                            break;
                    }
                }
                
                super.do(game);
            }
            
            evaluateCondition(condition, game) {
                // Replace variables in condition with actual values
                let evalStr = condition;
                evalStr = evalStr.replace(/count/g, this.count);
                evalStr = evalStr.replace(/mental/g, game.mental);
                evalStr = evalStr.replace(/voltageLevel/g, game.getVoltageLevel());
                evalStr = evalStr.replace(/turn/g, game.turn + 1); // turn is 0-indexed
                
                try {
                    return eval(evalStr);
                } catch (e) {
                    console.error('Error evaluating condition:', condition, e);
                    return false;
                }
            }
            
            processEffects(effects, game, prefix) {
                for (let j = 0; j < effects.length; j++) {
                    const effect = effects[j];
                    const key = `${prefix}_${j}_value`;
                    
                    switch (effect.type) {
                        case 'scoreBoost':
                            const scoreBoostValue = this.skillValues[key] !== undefined ? 
                                parseFloat(this.skillValues[key]) : effect.value;
                            game.doScoreBoost(scoreBoostValue);
                            break;
                            
                        case 'voltageBoost':
                            const voltageBoostValue = this.skillValues[key] !== undefined ? 
                                parseFloat(this.skillValues[key]) : effect.value;
                            game.doVoltageBoost(voltageBoostValue);
                            break;
                            
                        case 'scoreGain':
                            const scoreGainValue = this.skillValues[key] !== undefined ? 
                                parseFloat(this.skillValues[key]) : effect.value;
                            game.getScore(scoreGainValue);
                            break;
                            
                        case 'voltageGain':
                            const voltageGainValue = this.skillValues[key] !== undefined ? 
                                parseInt(this.skillValues[key]) : effect.value;
                            game.getVoltage(voltageGainValue);
                            break;
                            
                        case 'voltagePenalty':
                            game.voltagePt -= effect.value;
                            break;
                            
                        case 'resetCardTurn':
                            game.cardTurn = -1;
                            break;
                    }
                }
            }
        }

        // Card factory
        function createCard(cardType, skillValues) {
            if (!cardData[cardType]) return null;
            return new GenericCard(cardType, cardData[cardType], skillValues);
        }

        // Toggle music input
        function toggleMusicInput() {
            const musicSelect = document.getElementById('music');
            const customMusic = document.getElementById('customMusic');
            if (musicSelect.value === 'custom') {
                customMusic.style.display = 'block';
            } else {
                customMusic.style.display = 'none';
            }
        }

        // Calculate function
        function calculate() {
            const appeal = parseInt(document.getElementById('appeal').value);
            const musicKey = document.getElementById('music').value;
            let music;
            
            if (musicKey === 'custom') {
                music = [
                    parseInt(document.getElementById('beforeFever').value),
                    parseInt(document.getElementById('duringFever').value),
                    parseInt(document.getElementById('afterFever').value)
                ];
            } else {
                music = musicData[musicKey].phases;
            }
            
            const cards = [];
            for (let i = 1; i <= 6; i++) {
                const cardType = document.getElementById(`card${i}`).value;
                if (cardType) {
                    const skillValues = getSkillValues(i);
                    cards.push(createCard(cardType, skillValues));
                }
            }
            
            if (cards.length === 0) {
                alert('少なくとも1枚のカードを選択してください。');
                return;
            }
            
            const game = new Game(cards, appeal, music, true);
            game.doGame();
            
            document.getElementById('score').textContent = game.score.toLocaleString();
            document.getElementById('result').style.display = 'block';
            document.getElementById('turnLog').textContent = game.log;
        }

        // Toggle log display
        function toggleLog() {
            const log = document.getElementById('turnLog');
            if (log.style.display === 'none' || log.style.display === '') {
                log.style.display = 'block';
                document.querySelector('.toggle-log').textContent = '詳細ログを隠す';
            } else {
                log.style.display = 'none';
                document.querySelector('.toggle-log').textContent = '詳細ログを表示';
            }
        }

        // Load card data from JSON
        async function loadCardData() {
            try {
                const response = await fetch('cards.json');
                const data = await response.json();
                cardData = data.cards;
                musicData = data.music;
                
                // Populate card dropdowns
                populateCardDropdowns();
                
                // Populate music dropdown
                populateMusicDropdown();
                
                // Set default selections
                setDefaultSelections();
            } catch (error) {
                console.error('Failed to load card data:', error);
                alert('カードデータの読み込みに失敗しました。');
            }
        }
        
        function populateCardDropdowns() {
            for (let i = 1; i <= 6; i++) {
                const select = document.getElementById(`card${i}`);
                select.innerHTML = '<option value="">未選択</option>';
                
                for (const [key, card] of Object.entries(cardData)) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = card.displayName;
                    select.appendChild(option);
                }
            }
        }
        
        function populateMusicDropdown() {
            const select = document.getElementById('music');
            select.innerHTML = '';
            
            for (const [key, music] of Object.entries(musicData)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = `${music.name} (${music.phases.join(', ')})`;
                select.appendChild(option);
            }
            
            // Add custom option
            const customOption = document.createElement('option');
            customOption.value = 'custom';
            customOption.textContent = 'カスタム入力';
            select.appendChild(customOption);
        }
        
        function setDefaultSelections() {
            document.getElementById('card1').value = 'sachi';
            document.getElementById('card2').value = 'bdMegu';
            document.getElementById('card3').value = 'gingaKozu';
            document.getElementById('card4').value = 'iDoMeSayaka';
            document.getElementById('card5').value = 'iDoMeKaho';
            document.getElementById('card6').value = 'butoRuri';
            
            // Trigger card change events to show skill options
            for (let i = 1; i <= 6; i++) {
                onCardChange(i);
            }
        }
        
        // Handle card selection change
        function onCardChange(slotNum) {
            const cardSelect = document.getElementById(`card${slotNum}`);
            const skillSelect = document.getElementById(`skill${slotNum}`);
            const skillParams = document.getElementById(`skillParams${slotNum}`);
            
            if (cardSelect.value) {
                skillSelect.style.display = 'inline-block';
                generateSkillParams(slotNum, cardSelect.value);
                skillParams.style.display = 'block';
            } else {
                skillSelect.style.display = 'none';
                skillParams.style.display = 'none';
            }
        }
        
        // Handle skill level change
        function onSkillLevelChange(slotNum) {
            // Currently just uses manual input values
        }
        
        // Generate skill parameter inputs
        function generateSkillParams(slotNum, cardType) {
            const skillParams = document.getElementById(`skillParams${slotNum}`);
            const card = cardData[cardType];
            if (!card) return;
            
            let html = '';
            const effects = card.effects;
            let hasParams = false;
            
            // Process effects array
            for (let i = 0; i < effects.length; i++) {
                const effect = effects[i];
                html += generateEffectInputs(effect, slotNum, i, '');
                
                if (effect.value !== undefined || 
                    (effect.type === 'conditional' && (effect.then || effect.else))) {
                    hasParams = true;
                }
            }
            
            // Hide params div if no parameters
            if (!hasParams) {
                skillParams.style.display = 'none';
                html = '<div style="color: #666; font-size: 14px;">このカードには調整可能なパラメータがありません</div>';
            }
            
            skillParams.innerHTML = html;
        }
        
        // Generate input fields for effects
        function generateEffectInputs(effect, slotNum, effectIndex, prefix) {
            let html = '';
            const inputId = prefix ? `skill${slotNum}_${prefix}_${effectIndex}_value` : `skill${slotNum}_effect_${effectIndex}_value`;
            
            switch (effect.type) {
                case 'scoreBoost':
                    html += `<div class="skill-param-row">
                        <label>スコアブースト:</label>
                        <input type="number" id="${inputId}" value="${effect.value}" step="0.001">
                    </div>`;
                    break;
                    
                case 'voltageBoost':
                    html += `<div class="skill-param-row">
                        <label>ボルテージブースト:</label>
                        <input type="number" id="${inputId}" value="${effect.value}" step="0.001">
                    </div>`;
                    break;
                    
                case 'scoreGain':
                    html += `<div class="skill-param-row">
                        <label>スコア倍率:</label>
                        <input type="number" id="${inputId}" value="${effect.value}" step="0.01">
                    </div>`;
                    break;
                    
                case 'voltageGain':
                    html += `<div class="skill-param-row">
                        <label>ボルテージ獲得:</label>
                        <input type="number" id="${inputId}" value="${effect.value}" step="1">
                    </div>`;
                    break;
                    
                case 'conditional':
                    html += `<div style="margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px;">
                        <div style="font-weight: bold; margin-bottom: 5px;">条件: ${effect.condition}</div>`;
                    
                    if (effect.then) {
                        html += '<div style="margin-left: 10px;">';
                        html += '<div style="font-weight: bold; color: #2196F3;">条件成立時:</div>';
                        for (let j = 0; j < effect.then.length; j++) {
                            html += generateEffectInputs(effect.then[j], slotNum, j, `effect_${effectIndex}_then`);
                        }
                        html += '</div>';
                    }
                    
                    if (effect.else) {
                        html += '<div style="margin-left: 10px;">';
                        html += '<div style="font-weight: bold; color: #f44336;">条件不成立時:</div>';
                        for (let j = 0; j < effect.else.length; j++) {
                            html += generateEffectInputs(effect.else[j], slotNum, j, `effect_${effectIndex}_else`);
                        }
                        html += '</div>';
                    }
                    
                    html += '</div>';
                    break;
            }
            
            return html;
        }
        
        // Get skill values from inputs
        function getSkillValues(slotNum) {
            const values = {};
            const inputs = document.querySelectorAll(`#skillParams${slotNum} input`);
            
            inputs.forEach(input => {
                const id = input.id;
                const key = id.replace(`skill${slotNum}_`, '');
                values[key] = input.value;
            });
            
            return values;
        }
        
        // Initialize on page load
        window.onload = function() {
            loadCardData();
        };
    </script>
</body>
</html>