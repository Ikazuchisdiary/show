# v2 実装タスクリスト - 優先順位付き

## 🚨 Critical - 基本機能の修正（今すぐ必要）

### 1. ✅ スキルパラメータ編集機能の実装
```typescript
// 現在（間違い）
<input type="number" value={calculateValue(effect.value)} readOnly />

// 修正後
<input 
  type="number" 
  defaultValue={calculateValue(effect.value)}
  onChange={(e) => handleSkillValueChange(slotIndex, effectIndex, e.target.value)}
  placeholder={calculateValue(effect.value)}
/>
```

**実装内容:**
- [x] gameStoreに`customSkillValues`ステートを追加
- [x] 編集値の保存と読み込み機能
- [x] 修正値のハイライト表示（背景色: #fffbdd）
- [x] デフォルト値へのリセット機能

### 2. ✅ センターキャラクター基本実装
**実装内容:**
- [x] 楽曲のセンターキャラクターと一致するカードをハイライト
- [x] CardSelectorに`isCenter`プロパティを追加
- [x] センターカードの枠線をオレンジ色（#ff9800）に変更
- [x] センター特性の効果をアピール値計算に反映（既に実装済みだった）

### 3. AP収支詳細の実装
**実装内容:**
- [ ] AP獲得の詳細（基礎AP、カードによるAP獲得）
- [ ] AP消費の詳細（各カードのAP消費）
- [ ] 収支バランスの表示（プラス：緑、マイナス：赤）
- [ ] 展開/折りたたみ可能なUI

## ⚡ High Priority - コア機能の完成（1週間以内）

### 4. センタースキルシステム
**実装内容:**
- [ ] センタースキルレベル選択UI（各カードスロットに追加）
- [ ] センタースキルのパラメータ入力欄
- [ ] 発動タイミングの実装：
  - [ ] `beforeFirstTurn`: ターン0の前に発動
  - [ ] `beforeFeverStart`: フィーバー開始時
  - [ ] `afterLastTurn`: 最終ターン後
- [ ] センタースキル効果の計算への統合

### 5. ローカルストレージ実装
```typescript
interface StorageKeys {
  cardSkillLevel: `sukushou_card_skill_${string}`;
  centerSkillLevel: `sukushou_card_center_skill_${string}`;
  customMusicList: 'sukushou_custom_music_list';
  musicState: `sukushou_state_${string}`;
  lastVersion: 'sukushou_lastVersion';
}
```

**実装内容:**
- [ ] スキルレベルの自動保存
- [ ] カスタム楽曲リストの保存
- [ ] 楽曲別編成の保存/読み込み
- [ ] 共有モードでの保存無効化

### 6. ターンログの完全実装
**現在の表示:**
```
T1: 乙宗梢
スコア +12,345
ボルテージ +200 (Lv.8)
```

**v1準拠の表示:**
```
T1: [Kg] ［輪廻の銀河へ］乙宗梢 (AP-10)
  ボルテージ 216%ブースト
  ボルテージ +432 (Lv.8) 
  カード順リセット
  [計算] 7440 × 2.88 × 1.8 × 1.9 = 73,290
        アピール 倍率 ボルテージ
```

**実装内容:**
- [ ] カードの完全な表示名
- [ ] 効果の詳細説明
- [ ] 計算式の要素別表示
- [ ] 効果タイプ別の色分け

## 📋 Medium Priority - UX改善（2週間以内）

### 7. カスタム楽曲管理
- [ ] 「この設定を保存」ボタン
- [ ] 保存済みカスタム楽曲リスト
- [ ] 削除機能（確認ダイアログ付き）
- [ ] 上書き保存の確認

### 8. アップデートバナーシステム
- [ ] 新バージョン検出
- [ ] 更新内容の表示
- [ ] 「今後表示しない」オプション
- [ ] 更新履歴モーダル

### 9. AP不足最適化
- [ ] カード除外シミュレーション
- [ ] 最小スコア損失の組み合わせ計算
- [ ] 除外提案の表示

### 10. 重複キャラクター検出
- [ ] 同一キャラクターの検出
- [ ] 該当スロットのハイライト（赤枠）
- [ ] 警告メッセージ表示

## 🎨 Low Priority - 追加改善（1ヶ月以内）

### 11. モバイル最適化
- [ ] タッチ操作のドラッグ&ドロップ
- [ ] 長押し（500ms）でドラッグ開始
- [ ] スワイプ操作の対応
- [ ] レスポンシブデザインの微調整

### 12. ビジュアル改善
- [ ] ドラッグヒントアニメーション
- [ ] 共有モードの背景色
- [ ] フィーバーフェーズの🔥アイコン
- [ ] スムーズなトランジション

### 13. エラーハンドリング
- [ ] localStorage容量超過対応
- [ ] 不正なURL パラメータ処理
- [ ] ネットワークエラー時のフォールバック

## 📊 実装進捗トラッキング

| タスク | 優先度 | 見積もり時間 | 担当 | ステータス |
|-------|--------|------------|------|-----------|
| スキルパラメータ編集 | Critical | 4h | - | ✅ 完了 |
| センターキャラクター | Critical | 6h | - | ✅ 完了 |
| AP収支詳細 | Critical | 4h | - | 未着手 |
| センタースキル | High | 8h | - | 未着手 |
| ローカルストレージ | High | 6h | - | 未着手 |
| ターンログ改善 | High | 4h | - | 未着手 |
| カード選択UI改善 | Critical | 8h | - | ✅ 完了 |
| ドラッグ&ドロップ改善 | High | 3h | - | ✅ 完了 |

**完了タスク:** 21時間
**残りタスク:** 22時間（Critical + High）

## 🔄 実装順序の推奨

1. **Day 1-2**: Critical機能の修正
   - スキルパラメータ編集
   - センターキャラクター基本

2. **Day 3-4**: 計算精度の向上
   - AP収支詳細
   - センタースキル実装

3. **Day 5-6**: データ永続化
   - ローカルストレージ
   - ターンログ改善

4. **Week 2**: UX改善
   - カスタム楽曲管理
   - アップデートバナー
   - AP最適化

---

*作成日: 2024-07-24*
*最終更新: 2025-07-24*
*目標完了日: 2024-08-07（2週間）*

## 🎉 完了済みタスク

### カード選択UI改善
- [x] v1とv2の差分分析
- [x] スキルレベル変更時の数値更新バグ修正
- [x] 条件付き効果の表示改善
- [x] フォント、マージン、パディングの調整
- [x] キャラクター順序をv1準拠に
- [x] インラインスタイルのCSS化

### ドラッグ&ドロップ改善
- [x] 着地位置予告線（緑色のインジケーター）
- [x] カード挿入ロジック（スワップではなく挿入）
- [x] カスタムスキル値の適切な移動処理